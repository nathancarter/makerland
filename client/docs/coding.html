<html>
    <head>
        <script src='https://code.jquery.com/jquery-1.11.2.min.js'></script>
        <script src='https://code.jquery.com/jquery-migrate-1.2.1.min.js'>
        </script>
        <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css'/>
        <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css'/>
        <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js'>
        </script>
        <link rel="stylesheet" href="../codemirror.css">
        <script src="../codemirror.js"></script>
        <script src="../codemirror-javascript-mode.js"></script>
        <title>MakerLand Help</title>
    </head>
    <body style='padding-top: 50px;'>

        <nav class="navbar navbar-inverse navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <a class="navbar-brand" href="index.html">MakerLand Help</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
              <ul class="nav navbar-nav">
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="commands.html">Commands</a></li>
                <li><a href="ideas.html">Ideas</a></li>
                <li class="active"><a href="#">Coding</a></li>
                <li><a href="reference.html">Reference</a></li>
                <li><a href="challenges.html">Challenges</a></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </nav>

        <div class="container">

            <div class="starter-template">
                <h1>Coding</h1>
                <p class="lead">Putting JavaScript into MakerLand</p>
            </div>

            <hr>

            <h2><a name='behaviors'></a>Behaviors</h2>

            <h3><a name='what-are-behaviors'></a>What are behaviors?</h3>

            <p>In MakerLand, a "behavior" is a piece of code that can be
                attached to something that lives in the game world, so that
                the thing "behaves" in a specific way, as defined by the
                code.</p>
            <p>For example, if you wanted to make a portal that teleports
                players to a new location in the game world, you would begin
                by placing a landscape item on the map that looks like a
                portal.  At first, it would do nothing when players stepped
                on it; without a behavior that defines what it means for it
                to teleport players, it is just a decoration.  When the
                teleportation behavior is attached to it, it then becomes an
                active portal.</p>
            <p>MakerLand supports behaviors for landscape items, movable
                items, and creatures.</p>

            <h3><a name='attaching-behaviors'></a>Attaching behaviors</h3>

            <p>A single behavior in the database can be attached to many
                objects in the game world.  The process for attaching it to
                any one item is given here.</p>
            <p>This section assumes that you are working in the Sample
                Universe, or a universe that you created by extending the
                Sample Universe.  In particular, we will be attaching the
                "Shows text (like a sign)" behavior to a landscape item, so
                your universe must have that behavior.  Also, you should go
                stand near a landscape item, such as one of the tree in the
                Sample Universe, to use in the following steps.</p>
            <ol>
                <li>Move your avatar near the landscape item to which you
                    wish to attach the behavior.</li>
                <li>Click the World command button, then the "Edit landscape
                    items on map" button.</li>
                <li>Click the landscape item you wish to edit.
                    (If there are many items on top of one another,
                    it will list them all and ask you to choose the one you
                    intended to click.)</li>
                <li>Click the "Edit behaviors" button for that item.</li>
                <li>Browse the list of behaviors until you
                    find "Shows text (like a sign)".  Click its Attach
                    button and it will appear on the list of attached
                    behaviors, at the top.</li>
                <li>Click the Edit button on the newly-attached behavior.
                    It shows you that it has exactly one parameter, "text."
                    It also explains to you what that parameter means.  Go
                    ahead and fill in some simple text, such as "Hello" and
                    then save.</li>
            </ol>
            <p>The behavior has been attached to the landscape item.  Take a
                step away from the landscape item (if you're standing on top
                of it) and then back onto it.  The behavior should activate,
                and you should be able to see the text, as if the item were
                a sign.</li>
            <p>To un-attach a behavior, follow the same sequence of steps as
                above, but instead of clicking Attach, click Remove.</p>

            <h3><a name='many-opportunities'></a>Many opportunities</h3>

            <p>Although the example above just shows you how to make a
                landscape item show text like a sign, there are many more
                things you can do with behaviors.  The Sample Universe comes
                with built-in behaviors that do all of the following.</p>
            <ul>
                <li>Shows text (as introduced above)</li>
                <li>Teleports a player (which is how the portal transports a
                    player from the introductory hallway to the island)</li>
                <li>Spawns a creature (which makes landscape items
                    periodically spawn copies of a creature)</li>
                <li>Wanders near spawn point (which you attach to a
                    creature to make it wander near its spawn point)</li>
                <li>Gives a player a new command (which you use to grant
                    brand new players access to all the basic commands, and
                    new makers all the maker commands, as described below)
                    </li>
            </ul>
            <p>In addition to these examples, you can create new behaviors,
                as discussed in the next section.  But even without just the
                behaviors in the Sample Universe, you can already create
                some very interesting things.  If you're in the Sample
                Universe, the Getting Started page suggests several projects
                you can now accomplish, using what you know about behaviors.
                </p>

            <h3><a name='writing-behaviors'></a>Writing behaviors</h3>

            <div class='row'>
              <div class='col-md-6'>
                <p>If you are a maker looking to create a behavior, the
                following examples can give you some idea of how to do so.
                They begin with very trivial behaviors that are mostly
                useless, except that they function well as small examples to
                get you started.  Building on those small examples, we
                create larger and larger examples, until we've built the
                teleportation behavior described earlier on this page.</p>
              </div>
              <div class='col-md-6'>
                <div class="alert alert-danger" role="alert"><b>Warning!</b>
                This section assumes that you know how to program in
                JavaScript.  If you do not, you will need to learn to code
                in that language before you will be able
                to understand and/or complete this tutorial.</div>
              </div>
            </div>

            <h4>When does behavior code get run?</h4>
            <p>Behavior code gets run whenever the object to which it is
            attached gets loaded.  Examples:</p>
            <ul>
                <li>When you create a movable item in your inventory, any
                    behaviors attached to that item will have their code
                    run.</li>
                <li>When a player enters an area for the first time since
                    your game has loaded, all landscape items in that area
                    are created and their behavior code is run.</li>
                <li>If such landscape items have a behavior that spawns a
                    creature, that creature will therefore also be created,
                    and so any behaviors attached to it will be run.</li>
                <li>If players stay away from an area for a long time, its
                    contents will be unloaded to save memory.  When they
                    come back later, it will be reloaded, and the events
                    above will happen again.</li>
            </ul>
            <p>So when you're writing behavior code, think of it as code
            that <i>sets up</i> the object to which it's attached.  Assume
            the object was just loaded, and you need to add some new
            functionality to it.</p>

            <h4>What does behavior code look like?</h4>
            <p>You can see the code by browsing the Behaviors table in the
            game database, clicking "edit" on an entry, and then clicking
            "Edit implementation."  Let's look at the shortest example in
            the Sample Universe, the behavior that gives a player a new
            command.  Its code is the following.</p>
            <textarea class='code'>
// Listen for when a player enters this landscape item:
this.on( 'entered', function ( player ) {
    // Try to grant them the new command.  The following function will return true if the
    // player got the command, or false if they already had it.
    if ( player.grantCommand( command ) ) {
        // They just got the command, so we show them some text, with an OK button after it.
        player.showOK( "<h1>You learned a new command!</h1>"
                     + "<p>You can now use the \"" + command + "\" command.  "
                     + "When you click OK below, you will see it on your commands list.</p>"
                     + "<p>" + message + "</p>" );
        // We also play the "new command access" sound effect from the sounds table.
        playSound( 'new command access', player );
    }
} );</textarea>
            <p>Wow, there's a lot to notice there!  Let's consider each
            of the many things we can learn from this code.  (Keep in
            mind that I assume you already speak some JavaScript.)</p>
            <ul>
                <li>Behavior code in the Sample Universe is carefully
                commented to explain what's going on.</li>
                <li>The <code>this</code> keyword is defined in all
                behaviors.  It refers to the object to which the
                behavior is attached.  The behavior shown above is
                designed to be attached to a landscape item, so
                <code>this</code> will be that landscape item.</li>
                <li>Various objects have useful methods that it helps to
                know.  For instance, the <code>on</code> method is
                called in the landscape item, the
                <code>grantCommand</code> and <code>showOK</code>
                methods are called in a player, and the global
                <code>playSound</code> method is used.  There is reference
                documentation for all such methods, discussed below.</li>
                <li>This function works by installing an <i>event
                handler.</i>  The first line of code effectively says,
                "upon a player's entering this landscape item, do the
                following..."  Event handlers are very common in all
                kinds of coding, especially on the web, and we will use
                them a lot in MakerLand behaviors.</li>
            </ul>

            <h4>What kinds of behaviors can I write?</h4>
            <p>TONS!  Here is a sample list, in an order that makes sense to
                try to read through and learn from, one at a time.  Those
                marked "reference" are links to the reference page, which
                gives full source code you can re-use immediately, with full
                explanations of what each of its parts does.  Those marked
                "idea" are links to the ideas page, which gives some clues
                as to how to build the behavior, but leaves the coding to
                you, as a learning exercise.</p>
            <ul>
                <li><a href='ideas.html#wanders-randomly'>Wanders
                    randomly</a> (idea)</li>
                <li><a href='reference.html#whispers-secret'>Whispers a
                    secret</a> (reference)</li>
                <li><a
                    href='reference.html#occasionally speaks'>Occasionally
                    speaks</a> (reference)</li>
                <li><a href='ideas.html#is-readable'>Is readable</a>
                    (idea)</li>
                <li><a href='reference.html#gives-item'>Gives an item</a>
                    (reference)</li>
                <li><a href='ideas.html#more-gives-item'>Extending the
                    "gives an item" behavior</a> (idea)</li>
                <li><a href='reference.html#is-drinkable'>Is drinkable</a>
                    (reference)</li>
                <li><a href='reference.html#heal-drink'>Heals/harms when
                    drunk</a> (reference)</li>
                <li><a href='ideas.html#stat-drink'>Gives a stat bonus when
                    drunk</a> (idea)</li>
                <li><a href='ideas.html#status-drink'>Gives a status
                    condition when drunk</a> (idea)</li>
                <li><a href='reference.html#equipment-bonus'>Gives a stat
                    bonus when equipped</a> (reference)</li>
                <li><a href='ideas.html#spawns-with-item'>Spawns holding an
                    item</a> (idea)</li>
                <li><a href='ideas.html#spawns-with-item-sometimes'>Spawns
                    holding an item sometimes</a> (idea)</li>
                <li><a href='reference.html#equips-item'>Equips an item it's
                    carrying</a> (reference)</li>
                <li><a href='reference.html#heal-harm-touch'>Heals/harms
                    creatures touching it</a> (reference)</li>
                <li><a href='reference.html#aggression'>Aggression (makes a
                    creature attack things nearby)</a> (reference)</li>
                <li><a href='ideas.html#chases-enemies'>Chases enemies</a>
                    (idea)</li>
                <li><a href='ideas.html#flees-enemies'>Flees enemies</a>
                    (idea)</li>
                <li><a href='reference.html#refills-with-items'>Refills with
                    items from a list</a> (reference)</li>
                <li><a href='reference.html#makes-a-door'>Makes the cell
                    beneath it a door</a> (reference)</li>
                <li><a href='reference.html#makes-a-lock'>Makes a door
                    lockable</a> (reference)</li>
                <li><a href='reference.html#makes-a-key'>Makes an item a
                    door key</a> (reference)</li>
                <li><a href='ideas.html#trades-items'>Trades items with the
                    player</a> (idea)</li>
                <li><a href='ideas.html#walks-a-path'>Walks a set path</a>
                    (idea)</li>
                <li><a href='reference.html#prevent-get'>Can be picked up
                    only by certain people</a> (reference)</li>
                <li><a href='ideas.html#lucky-item'>An item that is lucky to
                    carry</a> (idea)</li>
                <li><a href='reference.html#stat-trainer'>Trains players in
                    a stat</a> (reference)</li>
            </ul>

            <h2><a name='animations'></a>Animations</h2>

            Remember for later:  The "Makes an item a launchable firework"
            behavior might be discussed here.

            <h3><a name='what-are-animations'></a>What are animations?</h3>

            <p>(Plus the existing content, except with reference material
                factored out.)</p>

            <h2><a name='abilities'></a>Abilities</h2>

            <h3><a name='what-are-abilities'></a>What are abilities?</h3>

            <h3><a name='giving-abilities'></a>Giving players abilities</h3>

            <h3><a name='writing-abilities'></a>Writing abilities</h3>

            Remember for later:  The "Acts as a magic beacon" behavior might
            be discussed here.

        </div>
    </body>
    <script src='codemirror-for-textareas.js'></script>
</html>
