{"name":"speak","__authors":["admin"],"duration":5,"description":"Shows a speech bubble containing the text in the \"text\" parameter.","code":"// choose font so we can measure bubble size\nfontPixelSize = 20;\nfont = fontPixelSize+'px Arial';\n// always keep the bubble over the speaker's head as he/she walks around\nvar location = POS( speaker );\n// some constants for size, shape, etc. of speech bubbles\nvar margin = 10;\nvar quirk = 10; // radius of curved tail below bubble\nvar minwidth = 50;\nvar bubbleWidth = Math.max( measureText( text ).width, 6*quirk );\n// compute relative positions of corners of bubble\nvar left = X( location )-bubbleWidth/2-margin;\nvar right = left + bubbleWidth+2*margin;\nvar top = Y( location )-CELL-2*margin-fontPixelSize*1.5;\nvar bottom = top + 2*margin+fontPixelSize*1.5;\nvar center = ( left + right ) / 2;\nvar offset = 2;\n// draw outline of bubble\nbeginPath();\nmoveTo( left, top );\nlineTo( right, top );\nlineTo( right, bottom );\nlineTo( center-(offset+1)*quirk, bottom );\nlineTo( center-(offset+1)*quirk, bottom+quirk );\narcTo( center-(offset+1)*quirk, bottom+2*quirk, center-offset*quirk, bottom+2*quirk, quirk );\narcTo( center-(offset+2)*quirk, bottom+2*quirk, center-(offset+2)*quirk, bottom, 2*quirk );\nlineTo( left, bottom );\nlineTo( left, top );\n// paint it white with a black border and black text\nfillStyle = '#ffffff';\nfill();\nstrokeStyle = '#000000';\nstroke();\nfillStyle = '#000000';\nfillText( text, left+margin, bottom-margin-fontPixelSize*0.5 );"}